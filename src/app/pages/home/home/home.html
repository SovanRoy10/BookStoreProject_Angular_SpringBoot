<div class="page">
  <!-- Search results (only if there are any) -->
  @if (searchResults.length > 0) {
  <div class="search-results">
    <h3>Search Results</h3>
    <div class="book-grid">
      @for (book of searchResults; track book.id) {
      <div class="book-card">
        <img [src]="book.coverImageUrl" alt="{{ book.title }}" />
        <h4>
          {{
            book.title.length > 16
              ? (book.title | slice : 0 : 16) + "..."
              : book.title
          }}
        </h4>
        <p>{{ book.author }}</p>
        <p>₹{{ book.price }}</p>
      </div>
      }
    </div>
  </div>
  } @if (isAdmin) {
  <h1 class="page-title topMargin">Admin Dashboard</h1>

  <button class="btn stats" [routerLink]="'admin/stats'">View Stats</button>

  <!-- Book Management -->
  <section class="section">
    <h2 class="section-title">Book Management</h2>
    <div class="btn-row">
      <button class="btn btn-primary" (click)="addBook()">Add Book</button>
      <!-- home.html -->
      <button class="btn btn-success" (click)="fileInput.click()">
        Import CSV
      </button>
      <input
        type="file"
        accept=".csv"
        #fileInput
        style="display: none"
        (change)="onFileSelected($event)"
      />
    </div>

    <div *ngIf="lowStockBooks.length > 0" class="low-stock-banner">
      ⚠ {{ lowStockBooks.length }} books are running low on stock.
      <a [routerLink]="'/admin/books/low-stock'">Review</a>
    </div>

    <table class="table">
      <thead>
        <tr>
          <th>Book ID</th>
          <th>Title</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (book of books; track book.id) {
        <tr>
          <td>{{ book.id }}</td>
          <td>{{ book.title }}</td>
          <td>₹{{ book.price }}</td>
          <td [ngClass]="{ 'low-stock': book.stockQuantity < 5 }">
            {{ book.stockQuantity }}
          </td>
          <td>
            <div class="admin-actions">
              <button class="btn btn-warning" (click)="editBook(book.id)">
                Edit
              </button>
              <button
                class="btn btn-danger"
                (click)="deleteBook(book.id, book.title)"
              >
                Delete
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </section>

 <!-- Users List -->
<section class="section">
  <h2 class="section-title">All Users</h2>
  <table class="table">
    <thead>
      <tr>
        <th>Email</th>
        <th>Name</th>
        <th>Role</th>
      </tr>
    </thead>
    <tbody>
      @for (user of users; track user.email) {
      <tr>
        <td>{{ user.email }}</td>
        <td>{{ user.name }}</td>
        <td>{{ user.role }}</td>
      </tr>
      } @if (users.length === 0) {
      <tr>
        <td colspan="3" class="empty">No users found.</td>
      </tr>
      }
    </tbody>
  </table>
</section>


  <!-- Orders Management -->
  <section class="section">
    <h2 class="section-title">Orders</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Book ID</th>
          <th>User ID</th>
          <th>Customer</th>
          <th>Order Date</th>
          <th>Order Time</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>#1001</td>
          <td>B001</td>
          <td>U123</td>
          <td>John Doe</td>
          <td>2025-08-10</td>
          <td>15:45</td>
          <td>
            <select class="select">
              <option>On the way</option>
              <option>Delivered</option>
              <option>Pending</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>#1002</td>
          <td>B002</td>
          <td>U456</td>
          <td>Jane Smith</td>
          <td>2025-08-11</td>
          <td>10:20</td>
          <td>
            <select class="select">
              <option>On the way</option>
              <option>Delivered</option>
              <option>Pending</option>
            </select>
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  } @else {
  <!-- USER VIEW -->

  <!-- Hero -->
  <section class="hero">
    <div class="hero-text">
      <h1>Discover Your Next Favorite Book</h1>
      <p>Browse through our curated collection and find books you'll love.</p>
      <a class="btn btn-primary" [routerLink]="'/books/all'">
        Browse All Books
      </a>
    </div>
  </section>

  <!-- All Books -->
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">All Books</h2>
      <a class="link" [routerLink]="'/books/all'">See All</a>
    </div>
    <div class="grid-books">
      @for (book of (books | slice:0:4); track book.id) {
      <div class="book-card">
        <img [src]="book.coverImageUrl" [alt]="book.title" />
        <div class="info">
          <div class="title">
            {{
              book.title.length > 19
                ? (book.title | slice : 0 : 19) + "..."
                : book.title
            }}
          </div>

          <div class="author">{{ book.author }}</div>
          <div class="meta">
            <span class="price">₹{{ book.price }}</span>
            <!-- <span class="rating">★ {{ book.rating }}</span> -->
          </div>
          <div>
            <a class="btnSmall btn-primary" [routerLink]="['/book', book.id]">
              View Details
            </a>
          </div>
        </div>
      </div>
      }`
    </div>
  </section>

  <!-- Recommended Books -->
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">Recommended Books</h2>
      <a class="link" [routerLink]="'/books/recommended'">See All</a>
    </div>
    <div class="grid-books">
      @for (book of (books | slice:0:4); track book.id) {
      <div class="book-card">
        <img [src]="book.coverImageUrl" [alt]="book.title" />
        <div class="info">
          <div class="title">
            {{
              book.title.length > 19
                ? (book.title | slice : 0 : 19) + "..."
                : book.title
            }}
          </div>
          <div class="author">{{ book.author }}</div>
          <div class="meta">
            <span class="price">₹{{ book.price }}</span>
            <!-- <span class="rating">★ {{ book.rating }}</span> -->
          </div>
          <div>
            <a class="btnSmall btn-primary" [routerLink]="['/book', book.id]">
              View Details
            </a>
          </div>
        </div>
      </div>
      }
    </div>
  </section>

  <!-- Trending Books -->
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">Trending Books</h2>
      <a class="link" [routerLink]="'/books/trending'">See All</a>
    </div>
    <div class="grid-books">
      @for (book of (books | slice:0:4); track book.id) {
      <div class="book-card">
        <img [src]="book.coverImageUrl" [alt]="book.title" />
        <div class="info">
          <div class="title">
            {{
              book.title.length > 19
                ? (book.title | slice : 0 : 19) + "..."
                : book.title
            }}
          </div>
          <div class="author">{{ book.author }}</div>
          <div class="meta">
            <span class="price">₹{{ book.price }}</span>
            <!-- <span class="rating">★ {{ book.rating }}</span> -->
          </div>
          <div>
            <a class="btnSmall btn-primary" [routerLink]="['/book', book.id]">
              View Details
            </a>
          </div>
        </div>
      </div>
      }
    </div>
  </section>
  }
</div>

<div *ngIf="loading" class="loader-container">
  <span class="loader"></span>
</div>
